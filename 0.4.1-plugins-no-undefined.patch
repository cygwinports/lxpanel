--- origsrc/lxpanel-0.3.8.1/configure.ac	2008-07-07 00:37:14.000000000 -0500
+++ src/lxpanel-0.3.8.1/configure.ac	2009-02-15 14:25:37.562500000 -0600
@@ -93,7 +93,7 @@ fi
 
 LXPANEL_MODULE="-avoid-version \
 -rpath \$(libdir)/lxpanel/plugins \
--no-undefined "'-export-symbols-regex "^[[^_]].*"'
+-no-undefined -Wl,\$(top_builddir)/src/liblxpanel.a "'-export-symbols-regex "^[[^_]].*"'
 AC_SUBST(LXPANEL_MODULE)
 
 AC_ARG_ENABLE([alsa],
--- origsrc/lxpanel-0.4.1/src/Makefile.am
+++ src/lxpanel-0.4.1/src/Makefile.am
@@ -1,6 +1,6 @@
 ## Process this file with automake to produce Makefile.in
 
-SUBDIRS = plugins
+SUBDIRS = . plugins
 
 bin_PROGRAMS = lxpanel lxpanelctl
 
@@ -41,7 +41,7 @@ lxpanel_SOURCES = \
 	$(MENU_SOURCES)
 
 if BUILD_PLUGIN_LOADER
-DYNAMIC_FLAGS = -export-dynamic
+DYNAMIC_FLAGS = -Wl,--export-all-symbols -Wl,--out-implib,liblxpanel.a
 lxpanel_includedir = $(includedir)/lxpanel
 lxpanel_include_HEADERS = $(top_srcdir)/include/lxpanel/plugin.h
 endif
@@ -63,3 +63,6 @@ lxpanelctl_LDADD = -lX11 $(INTLLIBS)
 
 EXTRA_DIST = \
 	plugins/icon.xpm
+
+$(top_builddir)/src/plugins/libbuiltin_plugins.a:
+	cd $(@D); $(MAKE) $(@F)
